name: Orchestrator Pipeline

on:
  push:
    branches: [ master ]
  pull_request:
    branches: [ master ]
  schedule:
    - cron: "0 0 * * *"

jobs:
  build:
    uses: ./.github/workflows/maven-build.yml
    secrets: inherit

  release_bundle:
    needs: build
    uses: ./.github/workflows/release-bundle.yml
    with:
      container_version: ${{ needs.build.outputs.container_version }}
      jfrog_project: ${{ vars.JFROG_PROJECT }}
    secrets: inherit

  rlm_evidence:
    needs: [ build, release_bundle ]
    uses: ./.github/workflows/rlm-evidence.yml
    with:
      image: ${{ needs.build.outputs.image }}
      digest: ${{ needs.build.outputs.digest }}
      container_version: ${{ needs.build.outputs.container_version }}
      jfrog_project: ${{ vars.JFROG_PROJECT }}
    secrets: inherit